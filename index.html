<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Fireworks Simulation</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar-nft.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #startButton, #launchButton {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #4CAF50;
        color: white;
        padding: 15px 25px;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        z-index: 2;
      }
      #launchButton { display: none; }
    </style>
  </head>
  <body>
    <button id="startButton">Start Experience</button>
    <button id="launchButton">🚀 Launch Fireworks</button>

    <a-scene
      id="scene"
      embedded
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-marker preset="hiro">
        <a-entity id="fireworks"></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const startButton = document.getElementById("startButton");
      const launchButton = document.getElementById("launchButton");
      const fireworks = document.getElementById("fireworks");
      const scene = document.getElementById("scene");

      startButton.addEventListener("click", () => {
        startButton.style.display = "none";
        launchButton.style.display = "block";

        // Forzar inicio de AR en móviles
        scene.setAttribute("arjs", "sourceType: webcam;");
      });

      launchButton.addEventListener("click", () => {
        for (let i = 0; i < 10; i++) {
          const sphere = document.createElement("a-sphere");
          const x = (Math.random() - 0.5) * 2;
          const y = 0;
          const z = (Math.random() - 0.5) * 2;

          sphere.setAttribute("position", `${x} ${y} ${z}`);
          sphere.setAttribute("radius", "0.1");
          sphere.setAttribute("color", getRandomColor());

          // Animación de subida
          sphere.setAttribute("animation", `
            property: position;
            to: ${x} ${2 + Math.random() * 2} ${z};
            dur: 1000;
            easing: ease-out
          `);

          // Animación de explosión
          sphere.setAttribute("animation__scale", `
            property: scale;
            to: 3 3 3;
            dur: 400;
            delay: 1000;
            fill: forwards
          `);

          fireworks.appendChild(sphere);

          // Eliminar esfera después de animación
          setTimeout(() => {
            if(fireworks.contains(sphere)) fireworks.removeChild(sphere);
          }, 1500);
        }
      });

      function getRandomColor() {
        const colors = ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00ffff"];
        return colors[Math.floor(Math.random() * colors.length)];
      }
    </script>
  </body>
</html>
